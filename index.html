<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b77a6">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <title>ìƒˆìš° ìƒ‰ ë„ê° + ëŒì—°ë³€ì´ ì˜ˆì¸¡ê¸° v1.4</title>
  <style>
    body{font-family: Arial, sans-serif;background:#f2fbff;color:#083b4c;margin:0;padding:16px;}
    .title-wrapper{display:flex;align-items:center;justify-content:center;gap:8px;}
    h1{text-align:center;color:#0b77a6;margin:8px 0;font-size: 28px;}
    @media (max-width: 420px){ h1 {font-size: 22px;} }
    #btnShare{background:transparent;border:none;font-size:22px;cursor:pointer;padding:0 4px;color:#0b77a6;}

    .sub{font-size:12px;text-align:center;color:#3f6b7a;margin-bottom:16px;}
    .card{background:#fff;border:1px solid #b9deee;border-radius:12px;padding:14px;margin-bottom:16px;box-shadow:0 2px 10px rgba(0,0,0,.03)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:860px){ .row{grid-template-columns:1fr} }
    label{display:block;margin:10px 0 4px;font-size:13px;color:#0b5b7a}
    select{width:100%;padding:10px;border:1px solid #9ed3e7;border-radius:10px;background:#f8fdff}
    button{padding:10px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:700}
    button.primary{background:#0aa3d8;color:#fff}
    button.secondary{background:#e6f7fc;color:#055b7a;border:1px solid #9ed3e7}
    .result{background:#fff;border:1px dashed #8ed1ea;border-radius:12px;padding:14px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #cfeaf3;border-radius:999px;background:#f6fbfd;margin:4px}
    .swatch{width:18px;height:18px;border:1px solid #8aa;border-radius:4px; background-size: cover;}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}
    .preview{border:1px solid #cfeaf3;border-radius:8px;overflow:hidden;background-size: cover; height:80px}
    .footer{font-size:12px;color:#4c6f7d;text-align:center;margin-top:10px}
  </style>
</head>
<body>
  <div class="title-wrapper">
    <h1>ğŸ¦ ìƒˆìš° ìƒ‰ ë„ê° + ëŒì—°ë³€ì´ ì˜ˆì¸¡ê¸° <span style="font-size:12px;">v1.4</span></h1>
    <button id="btnShare" title="ê³µìœ í•˜ê¸°">ğŸ”—</button>
  </div>
  <div class="sub">ì´ë¯¸ì§€ ì—†ì´ ìƒ‰ìƒ ì¹©ìœ¼ë¡œë§Œ í‘œì‹œë˜ëŠ” ê²½ëŸ‰ ë²„ì „ Â· ëª¨ë°”ì¼ ë°˜ì‘í˜•</div>

  <div class="card">
    <div class="row">
      <div>
        <label>ë¶€ëª¨ A - ì¢…ë¥˜</label>
        <select id="typeA"></select>
        <label>ë¶€ëª¨ A - ìƒ‰ìƒ</label>
        <select id="colorA"></select>
      </div>
      <div>
        <label>ë¶€ëª¨ B - ì¢…ë¥˜</label>
        <select id="typeB"></select>
        <label>ë¶€ëª¨ B - ìƒ‰ìƒ</label>
        <select id="colorB"></select>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="primary" id="btnPredict">ğŸ² ì˜ˆì¸¡í•˜ê¸°</button>
      <button class="secondary" id="btnSwap">â†”ï¸ ë¶€ëª¨ ë°”ê¾¸ê¸°</button>
      <button class="secondary" id="btnAddShortcut" style="display:none;">ğŸ“² ë°”ë¡œê°€ê¸° ì„¤ì¹˜</button>
    </div>
  </div>

  <div class="card">
    <div id="result" class="result">ë¶€ëª¨ë¥¼ ì„ íƒí•˜ê³  <b>ì˜ˆì¸¡í•˜ê¸°</b>ë¥¼ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</div>
  </div>

  <div class="card">
    <div class="grid" id="catalog"></div>
  </div>

  <div class="footer">ì œì‘: ë¯¼í›„ Ã— GPT Â· ë³¸ ë„êµ¬ëŠ” ì·¨ë¯¸/êµìœ¡ìš© ì˜ˆì¸¡ì´ë©° ì‹¤ì œ ê²°ê³¼ëŠ” ê°œì²´/ë¼ì¸ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.</div>

<script>
const SPECIES = { "neocaridina": { label:"ìƒì´ìƒˆìš°", colors:["íˆ¬ëª…","ê°ˆìƒ‰","íšŒìƒ‰","ë¹¨ê°•","ì£¼í™©","ë…¸ë‘","ì´ˆë¡","ì²­ë¡","íŒŒë‘","ë‚¨ìƒ‰","ë³´ë¼","ê²€ì •","ë°±ìƒ‰ë°˜ì ","í™©ê¸ˆë¹›","êµ¬ë¦¬ë¹›"] }, "caridina": { label:"í¬ë¦¬ìŠ¤íƒˆ/íƒ€ì´ì™„ë¹„", colors:["í°ìƒ‰","ê²€ì •","ë¹¨ê°•","íŒŒë‘(ë¸”ë£¨ë³¼íŠ¸)","íŒë‹¤ë¬´ëŠ¬","í‚¹ì½©ë¸”ë™","ë£¨ë¹„ë ˆë“œ","ëª¨ìŠ¤ë¼","ìŠ¤ë…¸ìš°í™”ì´íŠ¸"] }, "amano": { label:"ì•¼ë§ˆí† ìƒˆìš°", colors:["ë°˜íˆ¬ëª…","íšŒê°ˆìƒ‰ì ë¬´ëŠ¬","íšŒìƒ‰ì¤„ë¬´ëŠ¬"] } };
const COLOR_SWATCH = { "íˆ¬ëª…":"linear-gradient(45deg,#ffffff 25%, #e9f6fb 25% 50%, #ffffff 50% 75%, #e9f6fb 75%)","ê°ˆìƒ‰":"#7a5a3a","íšŒìƒ‰":"#9aa3a8","ë¹¨ê°•":"#e63232","ì£¼í™©":"#f59a23","ë…¸ë‘":"#ffd54a","ì´ˆë¡":"#47b26b","ì²­ë¡":"#3db7b4","íŒŒë‘":"#2f82ff","ë‚¨ìƒ‰":"#1f3b8a","ë³´ë¼":"#7a4fd6","ê²€ì •":"#111","ë°±ìƒ‰ë°˜ì ":"repeating-linear-gradient(45deg,#ffffff 0 6px,#ffffff 6px 10px,#eaeaea 10px 16px)","í™©ê¸ˆë¹›":"#cfa73a","êµ¬ë¦¬ë¹›":"#b5692f","í°ìƒ‰":"#ffffff","íŒŒë‘(ë¸”ë£¨ë³¼íŠ¸)":"#9fd3ff","íŒë‹¤ë¬´ëŠ¬":"linear-gradient(90deg,#000 33%,#fff 33% 66%,#000 66%)","í‚¹ì½©ë¸”ë™":"#000000","ë£¨ë¹„ë ˆë“œ":"#b9001a","ëª¨ìŠ¤ë¼":"linear-gradient(90deg,#fff 50%,#000 50%)","ìŠ¤ë…¸ìš°í™”ì´íŠ¸":"#f7fbff","ë°˜íˆ¬ëª…":"linear-gradient(45deg,#ffffff 25%, #e9f6fb 25% 50%, #ffffff 50% 75%, #e9f6fb 75%)","íšŒê°ˆìƒ‰ì ë¬´ëŠ¬":"repeating-radial-gradient(circle at 10px 10px,#9c7b5a 0 2px, #f3eee7 2px 8px)","íšŒìƒ‰ì¤„ë¬´ëŠ¬":"repeating-linear-gradient(90deg,#9aa3a8 0 8px,#c8d2d8 8px 16px)" };
const SHRIMP_PATTERNS = [ "radial-gradient(ellipse 50% 100% at 50% 0%, transparent 60%, rgba(0,0,0,0.1) 61%, transparent 62%)","radial-gradient(circle at 25% 30%, rgba(0,0,0,0.15) 10%, transparent 11%), radial-gradient(circle at 65% 70%, rgba(0,0,0,0.1) 12%, transparent 13%)","linear-gradient(135deg, transparent 45%, rgba(0,0,0,0.1) 45% 55%, transparent 55%)","radial-gradient(ellipse 100% 50% at 0% 100%, transparent 60%, rgba(0,0,0,0.1) 61%, transparent 62%)","transparent" ];

const typeA = document.getElementById('typeA'),typeB = document.getElementById('typeB'),colorA = document.getElementById('colorA'),colorB = document.getElementById('colorB'),result = document.getElementById('result'),catalog = document.getElementById('catalog'),btnPredict = document.getElementById('btnPredict'),btnSwap = document.getElementById('btnSwap'),btnShare = document.getElementById('btnShare'),btnAddShortcut = document.getElementById('btnAddShortcut');

function fillSpeciesOptions(){ 
  for (const key in SPECIES){ 
    let oA = document.createElement('option'); oA.value = key; 
    oA.textContent = SPECIES[key].label; let oB = oA.cloneNode(true); typeA.appendChild(oA); typeB.appendChild(oB); } typeA.value = 'neocaridina'; typeB.value = 'neocaridina'; fillColorOptions(typeA.value, colorA); fillColorOptions(typeB.value, colorB); }
function fillColorOptions(species, sel){ sel.innerHTML = ''; SPECIES[species].colors.forEach(c=>{ let o = document.createElement('option'); o.value = c; o.textContent = c; sel.appendChild(o); }); }
function blendedColor(c1,c2){ if(c1==="ê²€ì •"||c2==="ê²€ì •")return"ê²€ì •"; const set = new Set([c1,c2]); if(set.has("ë¹¨ê°•")&&set.has("ë…¸ë‘"))return"ì£¼í™©"; if(set.has("íŒŒë‘")&&set.has("ë…¸ë‘"))return"ì´ˆë¡"; if(set.has("ë¹¨ê°•")&&set.has("íŒŒë‘"))return"ë³´ë¼"; if(set.has("íŒŒë‘")&&set.has("ì´ˆë¡"))return"ì²­ë¡"; if(set.has("ê°ˆìƒ‰")||set.has("íšŒìƒ‰"))return"ê°ˆìƒ‰"; if(set.has("í°ìƒ‰")&&set.has("ê²€ì •"))return"íŒë‹¤ë¬´ëŠ¬"; return "íšŒìƒ‰"; }
function mutationPredict(a,b){ if(a.species!==b.species){ return {compatible:false, reason:"ë‹¤ë¥¸ ì¢…ì´ë¼ êµë°° ë¶ˆê°€ ë˜ëŠ” ë²ˆì‹ ì„±ê³µë¥ ì´ ë§¤ìš° ë‚®ì•„ìš”.", probs:[]}; } let probs=[]; if(a.color===b.color){ probs.push({color:a.color,p:75}); probs.push({color:"íšŒìƒ‰",p:15}); probs.push({color:a.species==="caridina"?"ìŠ¤ë…¸ìš°í™”ì´íŠ¸":"íˆ¬ëª…",p:10}); return {compatible:true, probs}; } probs.push({color:blendedColor(a.color,b.color),p:35}); probs.push({color:a.color,p:20}); probs.push({color:b.color,p:20}); probs.push({color:"ê°ˆìƒ‰",p:15}); probs.push({color:a.species==="caridina"?"ìŠ¤ë…¸ìš°í™”ì´íŠ¸":"íˆ¬ëª…",p:10}); return {compatible:true, probs}; }
function renderResult(out){ if(!out.compatible){ result.innerHTML=`âš ï¸ ${out.reason}`; return; } result.innerHTML = out.probs.map(x => { const randomPattern = SHRIMP_PATTERNS[Math.floor(Math.random() * SHRIMP_PATTERNS.length)]; const finalBackground = `${randomPattern}, ${COLOR_SWATCH[x.color] || '#ddd'}`; return `<span class="chip"><span class="swatch" style="background: ${finalBackground}"></span>${x.color} <b>${x.p}%</b></span>`; }).join(''); }

// âœ¨ ìˆ˜ì •ëœ í•¨ìˆ˜: í•˜ë‹¨ ë„ê°(catalog)ì—ë„ ë¬´ëŠ¬ í‘œì‹œ
function buildCatalog(){
  let html='';
  for(const key in SPECIES){
    SPECIES[key].colors.forEach(c=>{
      const randomPattern = SHRIMP_PATTERNS[Math.floor(Math.random() * SHRIMP_PATTERNS.length)];
      const finalBackground = `${randomPattern}, ${COLOR_SWATCH[c] || '#ddd'}`;
      html+=`<div class="preview" title="${SPECIES[key].label} - ${c}" style="background: ${finalBackground}"></div>`;
    });
  }
  catalog.innerHTML=html;
}

btnPredict.onclick = ()=>{ let a = {species:typeA.value, color:colorA.value}; let b = {species:typeB.value, color:colorB.value}; renderResult(mutationPredict(a,b)); };
btnSwap.onclick = ()=>{ let ta=typeA.value, tb=typeB.value, ca=colorA.value, cb=colorB.value; typeA.value=tb; typeB.value=ta; fillColorOptions(typeA.value,colorA); fillColorOptions(typeB.value,colorB); colorA.value=cb; colorB.value=ca; };
btnShare.onclick = async () => { const shareData = { title: 'ìƒˆìš° ìƒ‰ ë„ê° + ëŒì—°ë³€ì´ ì˜ˆì¸¡ê¸°', text: 'ìƒˆìš° êµë°° ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ì˜ˆì¸¡í•´ ë³´ì„¸ìš”!', url: window.location.href }; try { if (navigator.share) { await navigator.share(shareData); } else { await navigator.clipboard.writeText(window.location.href); alert('í˜ì´ì§€ ì£¼ì†Œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆì–´ìš”!'); } } catch (err) { console.error("ê³µìœ  ì‹¤íŒ¨:", err); alert('ê³µìœ ì— ì‹¤íŒ¨í–ˆì–´ìš”.'); } };

// âœ¨ ìˆ˜ì •ëœ ë¶€ë¶„: ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ë° ë°”ë¡œê°€ê¸° ì„¤ì¹˜ ê¸°ëŠ¥
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').then(registration => {
      console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì„±ê³µ:', registration.scope);
    }).catch(error => {
      console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:', error);
    });
  });
}
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; btnAddShortcut.style.display = 'inline-flex'; });
btnAddShortcut.onclick = async () => { if (deferredPrompt) { deferredPrompt.prompt(); const { outcome } = await deferredPrompt.userChoice; console.log(`ì‚¬ìš©ì ì„ íƒ: ${outcome}`); deferredPrompt = null; btnAddShortcut.style.display = 'none'; } };

fillSpeciesOptions();
buildCatalog();
</script>
</body>
</html>